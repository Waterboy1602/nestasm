var O=(t=>(t.SVG="svg",t.JSON="json",t))(O||{}),b=(t=>(t.IDLE="idle",t.START="start",t.PROCESSING="processing",t.FINISHED="finished",t.ERROR="error",t.CANCEL="cancel",t.INIT_SHARED_MEMORY="init_shared_memory",t.INTERMEDIATE="intermediate",t))(b||{}),S=(t=>(t.LBF="lbf",t.SPARROW="sparrow",t))(S||{});function W(t,e){return new Promise(n=>{t.addEventListener("message",function r({data:o}){o==null||o.type!==e||(t.removeEventListener("message",r),n(o))})})}W(self,"wasm_bindgen_worker_init").then(async t=>{const e=await import(t.mainJS);await e.default(t.module,t.memory),postMessage({type:"wasm_bindgen_worker_ready"}),e.wbg_rayon_start_worker(t.receiver)});async function B(t,e,n){if(n.numThreads()===0)throw new Error("num_threads must be > 0.");const r={type:"wasm_bindgen_worker_init",module:t,memory:e,receiver:n.receiver(),mainJS:n.mainJS()};await Promise.all(Array.from({length:n.numThreads()},async()=>{let o=await fetch(import.meta.url).then(c=>c.blob()),_=URL.createObjectURL(o);const s=new Worker(_,{type:"module"});return s.postMessage(r),await W(s,"wasm_bindgen_worker_ready"),URL.revokeObjectURL(_),s})),n.build()}let i,u=0,d=null;function h(){return(d===null||d.buffer!==i.memory.buffer)&&(d=new Uint8Array(i.memory.buffer)),d}const x=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},k=function(t,e){const n=x.encode(t);return e.set(n),{read:t.length,written:n.length}};function p(t,e,n){if(n===void 0){const c=x.encode(t),g=e(c.length,1)>>>0;return h().subarray(g,g+c.length).set(c),u=c.length,g}let r=t.length,o=e(r,1)>>>0;const _=h();let s=0;for(;s<r;s++){const c=t.charCodeAt(s);if(c>127)break;_[o+s]=c}if(s!==r){s!==0&&(t=t.slice(s)),o=n(o,r,r=s+t.length*3,1)>>>0;const c=h().subarray(o+s,o+r),g=k(t,c);s+=g.written,o=n(o,r,s,1)>>>0}return u=s,o}let y=null;function f(){return(y===null||y.buffer!==i.memory.buffer)&&(y=new DataView(i.memory.buffer)),y}function m(t){const e=i.__externref_table_alloc();return i.__wbindgen_export_5.set(e,t),e}function w(t,e){try{return t.apply(this,e)}catch(n){const r=m(n);i.__wbindgen_exn_store(r)}}const L=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&L.decode();function l(t,e){return t=t>>>0,L.decode(h().slice(t,t+e))}function a(t){return t==null}function A(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const o=t.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=t.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(t)){const o=t.length;let _="[";o>0&&(_+=A(t[0]));for(let s=1;s<o;s++)_+=", "+A(t[s]);return _+="]",_}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(n&&n.length>1)r=n[1];else return toString.call(t);if(r=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:r}function I(t){const e=i.__wbindgen_export_5.get(t);return i.__externref_table_dealloc(t),e}function N(t){const e=i.run_lbf(t);if(e[1])throw I(e[0])}function j(t,e){const n=i.init_logger(t,e);if(n[1])throw I(n[0])}function F(t,e,n,r,o,_){const s=i.run_sparrow(t,e,!a(n),a(n)?BigInt(0):n,!a(r),a(r)?BigInt(0):r,o,_);if(s[1])throw I(s[0])}function U(){return i.get_terminate_flag_offset()>>>0}function v(t){return i.initThreadPool(t)}const M=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>i.__wbg_wbg_rayon_poolbuilder_free(t>>>0,1));class R{static __wrap(e){e=e>>>0;const n=Object.create(R.prototype);return n.__wbg_ptr=e,M.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,M.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_wbg_rayon_poolbuilder_free(e,0)}mainJS(){return i.wbg_rayon_poolbuilder_mainJS(this.__wbg_ptr)}numThreads(){return i.wbg_rayon_poolbuilder_numThreads(this.__wbg_ptr)>>>0}receiver(){return i.wbg_rayon_poolbuilder_receiver(this.__wbg_ptr)>>>0}build(){i.wbg_rayon_poolbuilder_build(this.__wbg_ptr)}}async function D(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function P(){const t={};return t.wbg={},t.wbg.__wbg_String_8f0eb39a4a4c2f66=function(e,n){const r=String(n),o=p(r,i.__wbindgen_malloc,i.__wbindgen_realloc),_=u;f().setInt32(e+4*1,_,!0),f().setInt32(e+4*0,o,!0)},t.wbg.__wbg_buffer_609cc3eee51ed158=function(e){return e.buffer},t.wbg.__wbg_call_672a4d21634d4a24=function(){return w(function(e,n){return e.call(n)},arguments)},t.wbg.__wbg_debug_e17b51583ca6a632=function(e,n,r,o){console.debug(e,n,r,o)},t.wbg.__wbg_done_769e5ede4b31c67b=function(e){return e.done},t.wbg.__wbg_entries_3265d4158b33e5dc=function(e){return Object.entries(e)},t.wbg.__wbg_error_524f506f44df1645=function(e){console.error(e)},t.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,n){let r,o;try{r=e,o=n,console.error(l(e,n))}finally{i.__wbindgen_free(r,o,1)}},t.wbg.__wbg_error_80de38b3f7cc3c3c=function(e,n,r,o){console.error(e,n,r,o)},t.wbg.__wbg_getRandomValues_80578b2ff2a093ba=function(){return w(function(e){globalThis.crypto.getRandomValues(e)},arguments)},t.wbg.__wbg_get_67b2ba62fc30de12=function(){return w(function(e,n){return Reflect.get(e,n)},arguments)},t.wbg.__wbg_get_b9b93047fe3cf45b=function(e,n){return e[n>>>0]},t.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,n){return e[n]},t.wbg.__wbg_info_033d8b8a0838f1d3=function(e,n,r,o){console.info(e,n,r,o)},t.wbg.__wbg_instanceof_ArrayBuffer_e14585432e3737fc=function(e){let n;try{n=e instanceof ArrayBuffer}catch{n=!1}return n},t.wbg.__wbg_instanceof_Map_f3469ce2244d2430=function(e){let n;try{n=e instanceof Map}catch{n=!1}return n},t.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9=function(e){let n;try{n=e instanceof Uint8Array}catch{n=!1}return n},t.wbg.__wbg_instanceof_Window_def73ea0955fc569=function(e){let n;try{n=e instanceof Window}catch{n=!1}return n},t.wbg.__wbg_isArray_a1eab7e0d067391b=function(e){return Array.isArray(e)},t.wbg.__wbg_isSafeInteger_343e2beeeece1bb0=function(e){return Number.isSafeInteger(e)},t.wbg.__wbg_iterator_9a24c88df860dc65=function(){return Symbol.iterator},t.wbg.__wbg_length_a446193dc22c12f8=function(e){return e.length},t.wbg.__wbg_length_e2d2a49132c1b256=function(e){return e.length},t.wbg.__wbg_log_cad59bb680daec67=function(e,n,r,o){console.log(e,n,r,o)},t.wbg.__wbg_new_405e22f390576ce2=function(){return new Object},t.wbg.__wbg_new_5e0be73521bc8c17=function(){return new Map},t.wbg.__wbg_new_78feb108b6472713=function(){return new Array},t.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},t.wbg.__wbg_new_a12002a7f91c75be=function(e){return new Uint8Array(e)},t.wbg.__wbg_newnoargs_105ed471475aaf50=function(e,n){return new Function(l(e,n))},t.wbg.__wbg_newwithlength_a381634e90c276d4=function(e){return new Uint8Array(e>>>0)},t.wbg.__wbg_next_25feadfc0913fea9=function(e){return e.next},t.wbg.__wbg_next_6574e1a8a62d1055=function(){return w(function(e){return e.next()},arguments)},t.wbg.__wbg_now_2c95c9de01293173=function(e){return e.now()},t.wbg.__wbg_performance_7a3ffd0b17f663ad=function(e){return e.performance},t.wbg.__wbg_postMessage_15c7d80bb5337e79=function(e){postMessage(e)},t.wbg.__wbg_push_737cfc8c1432c2c6=function(e,n){return e.push(n)},t.wbg.__wbg_set_37837023f3d740e8=function(e,n,r){e[n>>>0]=r},t.wbg.__wbg_set_3f1d0b984ed272ed=function(e,n,r){e[n]=r},t.wbg.__wbg_set_65595bdd868b3009=function(e,n,r){e.set(n,r>>>0)},t.wbg.__wbg_set_8fc6bf8a5b1071d1=function(e,n,r){return e.set(n,r)},t.wbg.__wbg_set_bb8cecf6a62b9f46=function(){return w(function(e,n,r){return Reflect.set(e,n,r)},arguments)},t.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,n){const r=n.stack,o=p(r,i.__wbindgen_malloc,i.__wbindgen_realloc),_=u;f().setInt32(e+4*1,_,!0),f().setInt32(e+4*0,o,!0)},t.wbg.__wbg_startWorkers_2329d931beb7bef4=function(e,n,r){return B(e,n,R.__wrap(r))},t.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const e=typeof global>"u"?null:global;return a(e)?0:m(e)},t.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const e=typeof globalThis>"u"?null:globalThis;return a(e)?0:m(e)},t.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const e=typeof self>"u"?null:self;return a(e)?0:m(e)},t.wbg.__wbg_static_accessor_URL_151cb8815849ce83=function(){return import.meta.url},t.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const e=typeof window>"u"?null:window;return a(e)?0:m(e)},t.wbg.__wbg_subarray_aa9065fa9dc5df96=function(e,n,r){return e.subarray(n>>>0,r>>>0)},t.wbg.__wbg_timeOrigin_9f29a08704a944d0=function(e){return e.timeOrigin},t.wbg.__wbg_value_cd1ffa7b1ab794f1=function(e){return e.value},t.wbg.__wbg_warn_4ca3906c248c47c4=function(e){console.warn(e)},t.wbg.__wbg_warn_aaf1f4664a035bd6=function(e,n,r,o){console.warn(e,n,r,o)},t.wbg.__wbindgen_as_number=function(e){return+e},t.wbg.__wbindgen_bigint_from_i64=function(e){return e},t.wbg.__wbindgen_bigint_from_u128=function(e,n){return BigInt.asUintN(64,e)<<BigInt(64)|BigInt.asUintN(64,n)},t.wbg.__wbindgen_bigint_from_u64=function(e){return BigInt.asUintN(64,e)},t.wbg.__wbindgen_bigint_get_as_i64=function(e,n){const r=n,o=typeof r=="bigint"?r:void 0;f().setBigInt64(e+8*1,a(o)?BigInt(0):o,!0),f().setInt32(e+4*0,!a(o),!0)},t.wbg.__wbindgen_boolean_get=function(e){const n=e;return typeof n=="boolean"?n?1:0:2},t.wbg.__wbindgen_debug_string=function(e,n){const r=A(n),o=p(r,i.__wbindgen_malloc,i.__wbindgen_realloc),_=u;f().setInt32(e+4*1,_,!0),f().setInt32(e+4*0,o,!0)},t.wbg.__wbindgen_error_new=function(e,n){return new Error(l(e,n))},t.wbg.__wbindgen_in=function(e,n){return e in n},t.wbg.__wbindgen_init_externref_table=function(){const e=i.__wbindgen_export_5,n=e.grow(4);e.set(0,void 0),e.set(n+0,void 0),e.set(n+1,null),e.set(n+2,!0),e.set(n+3,!1)},t.wbg.__wbindgen_is_bigint=function(e){return typeof e=="bigint"},t.wbg.__wbindgen_is_function=function(e){return typeof e=="function"},t.wbg.__wbindgen_is_null=function(e){return e===null},t.wbg.__wbindgen_is_object=function(e){const n=e;return typeof n=="object"&&n!==null},t.wbg.__wbindgen_is_string=function(e){return typeof e=="string"},t.wbg.__wbindgen_is_undefined=function(e){return e===void 0},t.wbg.__wbindgen_jsval_eq=function(e,n){return e===n},t.wbg.__wbindgen_jsval_loose_eq=function(e,n){return e==n},t.wbg.__wbindgen_memory=function(){return i.memory},t.wbg.__wbindgen_module=function(){return E.__wbindgen_wasm_module},t.wbg.__wbindgen_number_get=function(e,n){const r=n,o=typeof r=="number"?r:void 0;f().setFloat64(e+8*1,a(o)?0:o,!0),f().setInt32(e+4*0,!a(o),!0)},t.wbg.__wbindgen_number_new=function(e){return e},t.wbg.__wbindgen_string_get=function(e,n){const r=n,o=typeof r=="string"?r:void 0;var _=a(o)?0:p(o,i.__wbindgen_malloc,i.__wbindgen_realloc),s=u;f().setInt32(e+4*1,s,!0),f().setInt32(e+4*0,_,!0)},t.wbg.__wbindgen_string_new=function(e,n){return l(e,n)},t.wbg.__wbindgen_throw=function(e,n){throw new Error(l(e,n))},t}function z(t,e){t.wbg.memory=e||new WebAssembly.Memory({initial:21,maximum:16384,shared:!0})}function C(t,e,n){if(i=t.exports,E.__wbindgen_wasm_module=e,y=null,d=null,typeof n<"u"&&(typeof n!="number"||n===0||n%65536!==0))throw"invalid stack size";return i.__wbindgen_start(n),i}async function E(t,e){if(i!==void 0)return i;let n;typeof t<"u"&&(Object.getPrototypeOf(t)===Object.prototype?{module_or_path:t,memory:e,thread_stack_size:n}=t:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof t>"u"&&(t=new URL("/nestasm/assets/nestasm_bg-gvVQZXN0.wasm",import.meta.url));const r=P();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t)),z(r,e);const{instance:o,module:_}=await D(await t,r);return C(o,_,n)}let T=!1;self.onmessage=async t=>{const{type:e,payload:n}=t.data,r=n.nWorkers;if(!T)try{const o=await E();T=!0;try{await j(5,n.showLogsInstant),self.postMessage({type:b.PROCESSING,message:"Wasm logger successfully initialized"})}catch(c){console.error("Failed to apply WASM logger:",c)}try{await v(r),self.postMessage({type:b.PROCESSING,message:`Wasm thread pool successfully initialized with ${r} threads`})}catch(c){console.error("Failed to initialize WASM thread pool:",c),self.postMessage({type:b.PROCESSING,message:`Failed to initialize WASM thread pool: ${c}`})}const _=o.memory.buffer;if(!(_ instanceof SharedArrayBuffer))throw new Error("WASM memory is not a SharedArrayBuffer! Check headers and build flags.");const s=U();self.postMessage({type:b.INIT_SHARED_MEMORY,message:"Worker: Shared memory initialized successfully.",result:{sharedArrayBuffer:_,terminateFlagOffset:s}})}catch(o){self.postMessage({type:b.ERROR,message:"Wasm initialization failed: "+o});return}if(e===b.START){self.postMessage({type:b.PROCESSING,message:"Wasm computation started"});const o=n.input;try{if(n.fileType===O.JSON){if(n.optimizationAlgo===S.LBF)N(o);else if(n.optimizationAlgo===S.SPARROW){let _;n.timeLimit&&(_=BigInt(n.timeLimit)),F(o,n.showPreviewSvg,_,n.seed,n.useEarlyTermination,n.nWorkers)}}}catch(_){self.postMessage({type:b.ERROR,message:"Wasm computation failed: "+_})}}};
